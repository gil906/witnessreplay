<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="WitnessReplay Admin Portal - Case Management">
    <meta name="theme-color" content="#0a0a0f">
    <title>Law Enforcement Dashboard - WitnessReplay</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”</text></svg>">
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/admin.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
</head>
<body class="admin-portal">
    <!-- Login Overlay -->
    <div id="login-overlay" class="login-overlay">
        <div class="login-container">
            <div class="login-header">
                <div class="login-icon">ğŸ›¡ï¸</div>
                <h2>WitnessReplay</h2>
                <p class="login-subtitle">Law Enforcement Portal</p>
            </div>
            
            <!-- Auth Tabs -->
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login" onclick="switchAuthTab('login')">Sign In</button>
                <button class="auth-tab" data-tab="register" onclick="switchAuthTab('register')">Create Account</button>
            </div>
            
            <!-- Login Form -->
            <form id="login-form" class="auth-form" autocomplete="on" aria-label="Sign in form">
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" name="username" class="login-input" placeholder="Enter username" required autofocus autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" name="password" class="login-input" placeholder="Enter password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary btn-login">ğŸ”“ Sign In</button>
                <div id="login-error" class="login-error" style="display: none;"></div>
                <button type="button" class="forgot-link" onclick="switchAuthTab('forgot')">Forgot password?</button>
            </form>
            
            <!-- Register Form -->
            <form id="register-form" class="auth-form" style="display:none;" autocomplete="on" aria-label="Create account form">
                <div class="form-group">
                    <label for="reg-fullname">Full Name</label>
                    <input type="text" id="reg-fullname" name="name" class="login-input" placeholder="John Smith" autocomplete="name">
                </div>
                <div class="form-group">
                    <label for="reg-email">Email</label>
                    <input type="email" id="reg-email" name="email" class="login-input" placeholder="john@department.gov" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="reg-username">Username</label>
                    <input type="text" id="reg-username" name="username" class="login-input" placeholder="Choose a username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="reg-password">Password</label>
                    <input type="password" id="reg-password" name="new-password" class="login-input" placeholder="Min 6 characters" required autocomplete="new-password">
                    <div id="password-strength" class="password-strength" style="display:none;">
                        <div class="strength-bar"><div class="strength-fill" id="strength-fill"></div></div>
                        <span class="strength-text" id="strength-text"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="reg-confirm">Confirm Password</label>
                    <input type="password" id="reg-confirm" name="confirm-password" class="login-input" placeholder="Repeat password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-login">ğŸ“ Create Account</button>
                <div id="register-error" class="login-error" style="display: none;"></div>
            </form>
            
            <!-- Forgot Password Form -->
            <form id="forgot-form" class="auth-form" style="display:none;" aria-label="Reset password form">
                <p class="forgot-desc">Enter your email address and we'll send you instructions to reset your password.</p>
                <div class="form-group">
                    <label for="forgot-email">Email</label>
                    <input type="email" id="forgot-email" class="login-input" placeholder="Your email address" required>
                </div>
                <button type="submit" class="btn btn-primary btn-login">ğŸ“§ Send Reset Link</button>
                <div id="forgot-message" class="login-error" style="display: none;"></div>
                <button type="button" class="forgot-link" onclick="switchAuthTab('login')">â† Back to Sign In</button>
            </form>
            
            <!-- OAuth Divider -->
            <div class="oauth-divider" id="oauth-divider">
                <span>or continue with</span>
            </div>
            
            <!-- OAuth Buttons -->
            <div class="oauth-buttons" id="oauth-buttons">
                <button type="button" class="oauth-btn google-btn" id="google-login-btn">
                    <svg viewBox="0 0 24 24" width="18" height="18"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    Google
                </button>
                <button type="button" class="oauth-btn github-btn" id="github-login-btn">
                    <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/></svg>
                    GitHub
                </button>
            </div>
            
            <div class="login-footer">
                <a href="/" class="back-link">â† Back to Witness View</a>
            </div>
        </div>
    </div>

    <script>
    function switchAuthTab(tab) {
        // Tabs
        document.querySelectorAll('.auth-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
        // Forms
        document.getElementById('login-form').style.display = tab === 'login' ? '' : 'none';
        document.getElementById('register-form').style.display = tab === 'register' ? '' : 'none';
        document.getElementById('forgot-form').style.display = tab === 'forgot' ? '' : 'none';
        // OAuth buttons show for login and register, hide for forgot
        const oauthDiv = document.getElementById('oauth-divider');
        const oauthBtns = document.getElementById('oauth-buttons');
        if (oauthDiv) oauthDiv.style.display = tab === 'forgot' ? 'none' : '';
        if (oauthBtns) oauthBtns.style.display = tab === 'forgot' ? 'none' : '';
    }
    </script>

    <div class="container admin-container" id="admin-content" style="display: none;">
        <!-- Admin Header -->
        <header class="header admin-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">ğŸ›¡ï¸</div>
                    <div class="logo-text">
                        <h1>Law Enforcement Dashboard</h1>
                    </div>
                </div>
                
                <div class="global-search-wrap" style="position:relative;">
                    <input type="text" id="global-search-input" placeholder="ğŸ” Search cases, sessions..." class="global-search-input" oninput="window.adminPortal?.handleGlobalSearch(this.value)" aria-label="Search cases and sessions">
                    <div id="global-search-results" class="global-search-results" style="display:none;"></div>
                </div>

                <div class="admin-user-info">
                    <div class="user-badge">
                        <div class="user-avatar">ğŸ‘®</div>
                        <div class="user-details">
                            <h3 id="admin-user-name">Officer Admin</h3>
                            <span id="user-display" class="user-display" style="display:none;"></span>
                        </div>
                    </div>
                </div>
                
                <button class="header-btn" onclick="window.adminPortal?.showNotificationCenter()" title="Notifications" aria-label="Open notifications">
                    ğŸ”” <span id="notif-badge" class="notif-badge" style="display:none">0</span>
                </button>
                <!-- Hidden: kept for JS references -->
                <div class="notification-bell" id="notification-bell" style="display:none;">
                    ğŸ”” <span class="notification-count" id="notification-count" style="display:none">0</span>
                </div>
                <button id="notification-mute-toggle" class="header-btn" style="display:none;">ğŸ”” Alerts On</button>

                <div class="admin-actions">
                    <button id="seed-data-btn" class="btn btn-secondary" style="display:none;" aria-label="Seed demo data">
                        ğŸŒ± Seed
                    </button>
                    <button id="refresh-btn" class="btn btn-secondary" data-tooltip="Refresh data" aria-label="Refresh data">
                        ğŸ”„
                    </button>
                    <button id="witness-view-btn" class="btn btn-primary" data-tooltip="Witness view" aria-label="Switch to witness view">
                        ğŸ™ï¸ Witness
                    </button>
                    <button id="logout-btn" class="btn btn-secondary" data-tooltip="Logout" aria-label="Logout">
                        ğŸšª
                    </button>
                </div>
            </div>
        </header>

        <!-- Admin Dashboard -->
        <div class="admin-dashboard">
            <!-- Stats Overview -->
            <section class="stats-overview">
                <div class="stat-card admin-stat">
                    <div class="stat-icon">ğŸ“</div>
                    <div class="stat-details">
                        <div class="stat-value" id="total-cases">0</div>
                        <div class="stat-label">Total Cases</div>
                    </div>
                </div>
                <div class="stat-card admin-stat">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-details">
                        <div class="stat-value" id="total-witnesses">0</div>
                        <div class="stat-label">Witness Reports</div>
                    </div>
                </div>
                <div class="stat-card admin-stat">
                    <div class="stat-icon">ğŸ“Œ</div>
                    <div class="stat-details">
                        <div class="stat-value" id="unassigned-reports">0</div>
                        <div class="stat-label">Unassigned Reports</div>
                    </div>
                </div>
                <div class="stat-card admin-stat">
                    <div class="stat-icon">â±ï¸</div>
                    <div class="stat-details">
                        <div class="stat-value" id="active-today">0</div>
                        <div class="stat-label">Active Today</div>
                    </div>
                </div>
                <div class="stat-card admin-stat">
                    <div class="stat-icon">ğŸ¬</div>
                    <div class="stat-details">
                        <div class="stat-value" id="total-scenes">0</div>
                        <div class="stat-label">Scenes Generated</div>
                    </div>
                </div>
            </section>

            <!-- Activity Sparkline Chart -->
            <section class="activity-chart-panel" id="activity-chart-panel">
                <div class="activity-chart-header">
                    <span class="activity-chart-title">ğŸ“ˆ Activity (Last 7 Days)</span>
                    <span class="activity-chart-total" id="activity-chart-total">-- reports</span>
                </div>
                <div class="activity-chart-container">
                    <svg id="activity-sparkline" viewBox="0 0 300 60" preserveAspectRatio="none" class="activity-sparkline">
                        <defs>
                            <linearGradient id="sparkline-gradient" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stop-color="rgba(96,165,250,0.3)"/>
                                <stop offset="100%" stop-color="rgba(96,165,250,0)"/>
                            </linearGradient>
                        </defs>
                        <path id="sparkline-area" fill="url(#sparkline-gradient)" d="M0,60 L300,60"/>
                        <path id="sparkline-line" fill="none" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M0,60 L300,60"/>
                    </svg>
                    <div class="activity-chart-labels" id="activity-chart-labels"></div>
                </div>
            </section>

            <!-- System Health Monitor -->
            <section class="system-health-panel" id="system-health-panel">
                <button class="quota-toggle" id="health-toggle" type="button">
                    <span class="quota-toggle-icon">â–¸</span> ğŸ’» System Health
                    <span class="health-status-badge" id="health-status-badge">Checking...</span>
                </button>
                <div class="health-content" id="health-content" style="display: none;">
                    <div class="health-grid">
                        <div class="health-metric">
                            <div class="health-metric-label">CPU</div>
                            <div class="health-bar"><div class="health-bar-fill" id="health-cpu-bar" style="width:0%"></div></div>
                            <div class="health-metric-value" id="health-cpu">--%</div>
                        </div>
                        <div class="health-metric">
                            <div class="health-metric-label">Memory</div>
                            <div class="health-bar"><div class="health-bar-fill" id="health-mem-bar" style="width:0%"></div></div>
                            <div class="health-metric-value" id="health-mem">--%</div>
                        </div>
                        <div class="health-metric">
                            <div class="health-metric-label">Disk</div>
                            <div class="health-bar"><div class="health-bar-fill" id="health-disk-bar" style="width:0%"></div></div>
                            <div class="health-metric-value" id="health-disk">--%</div>
                        </div>
                        <div class="health-metric">
                            <div class="health-metric-label">Uptime</div>
                            <div class="health-metric-value" id="health-uptime">--</div>
                        </div>
                        <div class="health-metric">
                            <div class="health-metric-label">Avg Response</div>
                            <div class="health-metric-value" id="health-response">-- ms</div>
                        </div>
                        <div class="health-metric">
                            <div class="health-metric-label">WebSockets</div>
                            <div class="health-metric-value" id="health-ws">--</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Admin Audit Timeline -->
            <section class="audit-timeline-panel" id="audit-timeline-panel">
                <button class="quota-toggle" id="audit-timeline-toggle" type="button">
                    <span class="quota-toggle-icon">â–¸</span> ğŸ“œ Audit Timeline
                    <span class="health-status-badge" id="audit-event-count">0 events</span>
                </button>
                <div class="audit-timeline-content" id="audit-timeline-content" style="display: none;">
                    <div class="audit-timeline-list" id="audit-timeline-list">
                        <div style="text-align:center;padding:16px;color:var(--text-muted);">Loading audit events...</div>
                    </div>
                </div>
            </section>

            <!-- Interview Analytics Widget -->
            <section class="interview-analytics-panel" id="interview-analytics-panel">
                <button class="quota-toggle" id="analytics-toggle" type="button">
                    <span class="quota-toggle-icon">â–¸</span> ğŸ“ˆ Interview Analytics
                    <span class="health-status-badge" id="analytics-summary">--</span>
                </button>
                <div class="interview-analytics-content" id="interview-analytics-content" style="display: none;">
                    <div class="analytics-grid" id="analytics-grid">
                        <div style="text-align:center;padding:16px;color:var(--text-muted);">Loading analytics...</div>
                    </div>
                </div>
            </section>

            <!-- Activity Heatmap -->
            <section class="activity-heatmap-panel" id="activity-heatmap-section">
                <div id="activity-heatmap" class="activity-heatmap">
                    <p class="heatmap-placeholder">ğŸ“Š Loading activity heatmap...</p>
                </div>
            </section>

            <!-- Data Retention Settings -->
            <section class="admin-panel" id="data-retention-section">
                <div id="data-retention-panel" class="data-retention-panel">
                    <p>ğŸ—„ï¸ Loading data retention settings...</p>
                </div>
            </section>

            <!-- Session Transcript Viewer -->
            <section class="admin-panel" id="session-viewer-section">
                <h3>ğŸ“œ Session Transcript Viewer</h3>
                <div class="session-viewer-controls">
                    <input type="text" id="sv-session-id" class="admin-input" placeholder="Enter session ID...">
                    <button id="sv-load-btn" class="admin-btn">ğŸ“– Load Transcript</button>
                </div>
                <div id="sv-transcript" class="sv-transcript"></div>
            </section>

            <!-- Activity Log -->
            <section class="admin-panel" id="activity-log-section">
                <h3>ğŸ“Š User Activity Log <button id="al-refresh-btn" class="admin-btn-sm" title="Refresh">ğŸ”„</button></h3>
                <div id="al-list" class="al-list"></div>
            </section>

            <!-- Case Analytics Dashboard -->
            <section class="admin-panel" id="case-analytics-section">
                <h3>ğŸ“ˆ Case Analytics <button id="ca-refresh-btn" class="admin-btn-sm" title="Refresh">ğŸ”„</button></h3>
                <div class="ca-stats" id="ca-stats">
                    <div class="ca-stat-card"><span class="ca-stat-num" id="ca-total">--</span><span class="ca-stat-label">Total Sessions</span></div>
                    <div class="ca-stat-card"><span class="ca-stat-num" id="ca-avg-stmts">--</span><span class="ca-stat-label">Avg Statements</span></div>
                    <div class="ca-stat-card"><span class="ca-stat-num" id="ca-avg-words">--</span><span class="ca-stat-label">Avg Words</span></div>
                    <div class="ca-stat-card"><span class="ca-stat-num" id="ca-active">--</span><span class="ca-stat-label">Active</span></div>
                </div>
                <div id="ca-chart" class="ca-chart"></div>
                <div id="ca-status-dist" class="ca-status-dist"></div>
            </section>

            <section class="admin-panel" id="health-dashboard-section">
                <h3>ğŸ’“ System Health <button id="hd-refresh-btn" class="admin-btn-sm" title="Refresh">ğŸ”„</button></h3>
                <div class="hd-grid" id="hd-grid">
                    <div class="hd-card"><span class="hd-icon">â±ï¸</span><span class="hd-val" id="hd-uptime">--</span><span class="hd-label">Uptime</span></div>
                    <div class="hd-card"><span class="hd-icon">ğŸ’¾</span><span class="hd-val" id="hd-memory">--</span><span class="hd-label">Memory</span></div>
                    <div class="hd-card"><span class="hd-icon">âš¡</span><span class="hd-val" id="hd-cpu">--</span><span class="hd-label">CPU</span></div>
                    <div class="hd-card"><span class="hd-icon">ğŸ“Š</span><span class="hd-val" id="hd-sessions">--</span><span class="hd-label">Sessions</span></div>
                    <div class="hd-card"><span class="hd-icon">ğŸ“</span><span class="hd-val" id="hd-statements">--</span><span class="hd-label">Statements</span></div>
                    <div class="hd-card"><span class="hd-icon">ğŸ•</span><span class="hd-val" id="hd-recent">--</span><span class="hd-label">Last 24h</span></div>
                </div>
            </section>

            <section class="admin-panel" id="bulk-export-section">
                <h3>ğŸ“¦ Bulk Export</h3>
                <div class="be-controls">
                    <select id="be-format" class="be-select"><option value="json">JSON</option><option value="csv">CSV</option></select>
                    <input type="number" id="be-limit" class="be-input" value="50" min="1" max="500" placeholder="Limit">
                    <button id="be-export-btn" class="admin-btn-sm">ğŸ“¥ Export All</button>
                </div>
                <div id="be-result" class="be-result" style="display:none"></div>
            </section>

            <!-- IMPROVEMENT 61: Admin Audit Trail -->
            <section class="admin-panel" id="audit-trail-section">
                <h3>ğŸ“‹ Audit Trail</h3>
                <div class="at-controls">
                    <button id="at-refresh-btn" class="admin-btn-sm">ğŸ”„ Refresh</button>
                    <span id="at-count" class="at-count">0 entries</span>
                </div>
                <div id="at-entries" class="at-entries">
                    <div class="at-empty">No audit entries yet</div>
                </div>
            </section>

            <!-- IMPROVEMENT 67: Admin Session Report -->
            <section class="admin-panel" id="session-report-section">
                <h3>ğŸ“Š Session Usage Report</h3>
                <div class="sr-controls">
                    <button id="sr-refresh-btn" class="admin-btn-sm">ğŸ”„ Refresh</button>
                </div>
                <div class="sr-stats-grid">
                    <div class="sr-stat-card"><div class="sr-stat-num" id="sr-total">â€”</div><div class="sr-stat-label">Total Sessions</div></div>
                    <div class="sr-stat-card"><div class="sr-stat-num" id="sr-avg-stmts">â€”</div><div class="sr-stat-label">Avg Statements</div></div>
                    <div class="sr-stat-card"><div class="sr-stat-num" id="sr-avg-words">â€”</div><div class="sr-stat-label">Avg Words</div></div>
                    <div class="sr-stat-card"><div class="sr-stat-num" id="sr-max-stmts">â€”</div><div class="sr-stat-label">Max Statements</div></div>
                </div>
                <div id="sr-status-dist" class="sr-status-dist"></div>
            </section>

            <!-- IMPROVEMENT 68: Admin System Alerts -->
            <section class="admin-panel" id="system-alerts-section">
                <h3>ğŸš¨ System Alerts <span id="sa-badge" class="sa-badge sa-badge-ok">ğŸŸ¢ OK</span></h3>
                <div class="sa-controls">
                    <button id="sa-refresh-btn" class="admin-btn-sm">ğŸ”„ Refresh</button>
                </div>
                <div id="sa-alerts" class="sa-alerts">
                    <div class="sa-alert sa-alert-ok"><span class="sa-alert-icon">ğŸŸ¢</span><span class="sa-alert-title">Checking...</span></div>
                </div>
            </section>

            <!-- IMPROVEMENT 77: API Usage Analytics -->
            <section class="admin-panel" id="api-usage-section">
                <h3>ğŸ“Š API Usage Analytics <button id="api-usage-refresh" class="admin-btn-sm">ğŸ”„</button></h3>
                <div id="api-usage-content" class="api-usage-content">
                    <div class="api-usage-loading">Loading usage data...</div>
                </div>
            </section>

            <!-- IMPROVEMENT 78: Active Sessions Monitor -->
            <section class="admin-panel" id="active-sessions-section">
                <h3>ğŸ–¥ï¸ Active Sessions <button id="active-sessions-refresh" class="admin-btn-sm">ğŸ”„</button></h3>
                <div class="as-summary" id="as-summary"></div>
                <div id="active-sessions-list" class="as-list">
                    <div class="as-loading">Loading sessions...</div>
                </div>
            </section>

            <!-- IMPROVEMENT 84: Error Log Viewer -->
            <section class="admin-panel" id="error-log-section">
                <h3>ğŸš¨ Error Log <button id="error-log-refresh" class="admin-btn-sm">ğŸ”„</button></h3>
                <div class="error-log-summary" id="error-log-summary"></div>
                <div id="error-log-list" class="error-log-list">
                    <div class="el-loading">Loading errors...</div>
                </div>
            </section>

            <!-- IMPROVEMENT 85: Performance Metrics -->
            <section class="admin-panel" id="perf-metrics-section">
                <h3>âš¡ Performance Metrics <button id="perf-refresh" class="admin-btn-sm">ğŸ”„</button></h3>
                <div class="perf-system" id="perf-system"></div>
                <div id="perf-endpoints" class="perf-list">
                    <div class="perf-loading">Loading metrics...</div>
                </div>
            </section>

            <!-- Data Retention Manager -->
            <section class="admin-panel" id="data-retention-mgr-section">
                <h3>ğŸ—„ï¸ Data Retention <button id="retention-refresh" class="admin-btn-sm">ğŸ”„</button></h3>
                <div class="retention-settings" id="retention-settings"></div>
                <div class="retention-stats" id="retention-stats">
                    <div class="ret-loading">Loading retention data...</div>
                </div>
            </section>

            <!-- System Configuration -->
            <section class="admin-panel" id="system-config-section">
                <h3>âš™ï¸ System Configuration <button id="config-refresh" class="admin-btn-sm">ğŸ”„</button></h3>
                <div id="system-config-content" class="system-config-content">
                    <div class="config-loading">Loading configuration...</div>
                </div>
            </section>

            <section class="admin-panel usage-trends-panel" id="usage-trends-section">
                <h3>ğŸ“ˆ Usage Trends <button id="trends-refresh" class="admin-btn-sm">ğŸ”„</button></h3>
                <div id="usage-trends-content">
                    <div class="config-loading">Loading trends...</div>
                </div>
            </section>

            <section class="admin-panel session-search-panel" id="session-search-section">
                <h3>ğŸ” Session Search</h3>
                <div class="search-input-wrap">
                    <input type="text" id="admin-search-input" class="search-input" placeholder="Search sessions by title or content...">
                    <button id="admin-search-btn" class="search-btn">Search</button>
                </div>
                <div id="session-search-results"></div>
            </section>

            <section class="admin-panel data-export-panel" id="data-export-section">
                <h3>ğŸ“¦ Data Export</h3>
                <div class="export-controls">
                    <select id="export-type-select" class="export-select">
                        <option value="sessions">Sessions</option>
                        <option value="errors">Error Log</option>
                        <option value="usage">Usage Data</option>
                    </select>
                    <select id="export-format-select" class="export-select">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                    </select>
                    <button id="export-btn" class="export-btn">Export</button>
                </div>
                <div id="export-result"></div>
            </section>

            <section class="admin-panel rate-limiter-panel" id="rate-limiter-section">
                <h3>ğŸš¦ Rate Limiter</h3>
                <div id="rate-limiter-content"><p>Loading...</p></div>
                <button id="rate-limiter-refresh" class="refresh-btn">â†» Refresh</button>
            </section>

            <!-- Feature Toggles -->
            <section class="admin-panel feature-toggles-panel" id="feature-toggles-section">
                <h3>ğŸ”§ Feature Toggles</h3>
                <div id="feature-toggles-content"><p>Loading...</p></div>
                <button id="feature-toggles-refresh" class="refresh-btn">â†» Refresh</button>
            </section>

            <!-- Notification Center -->
            <section class="admin-panel notification-center-panel" id="notification-center-section">
                <h3>ğŸ”” Notification Center</h3>
                <div id="notification-center-content"><p>Loading...</p></div>
                <button id="notification-center-refresh" class="refresh-btn">â†» Refresh</button>
            </section>

            <!-- Backup Manager -->
            <section class="admin-panel backup-manager-panel" id="backup-manager-section">
                <h3>ğŸ’¾ Backup Manager</h3>
                <div id="backup-manager-content"><p>Loading...</p></div>
                <div class="backup-manager-actions">
                    <button id="backup-manager-refresh" class="refresh-btn">â†» Refresh</button>
                    <button id="backup-manager-create" class="refresh-btn" style="background:#22c55e;">Create Backup</button>
                </div>
            </section>

            <!-- Activity Log -->
            <section class="admin-panel activity-log-panel" id="activity-log-ext-section">
                <h3>ğŸ“‹ User Activity Log</h3>
                <div id="activity-log-content"><p>Loading...</p></div>
                <button id="activity-log-refresh" class="refresh-btn">â†» Refresh</button>
            </section>

            <section class="admin-panel audit-trail-panel" id="audit-trail-ext-section">
                <h3>ğŸ” Audit Trail</h3>
                <div id="audit-trail-content"><p>Loading...</p></div>
                <button id="audit-trail-refresh" class="refresh-btn">â†» Refresh</button>
            </section>

            <section class="admin-panel sys-health-panel" id="system-health-section">
                <h3>ğŸ’š System Health</h3>
                <div id="system-health-content"><p>Loading...</p></div>
                <button id="system-health-refresh" class="refresh-btn">â†» Refresh</button>
            </section>

            <section class="admin-panel api-key-panel" id="api-key-manager-section">
                <h3>ğŸ”‘ API Key Manager</h3>
                <div id="api-key-manager-content"><p>Loading...</p></div>
                <button id="api-key-manager-refresh" class="refresh-btn">â†» Refresh</button>
            </section>

            <section class="admin-panel scheduled-tasks-panel" id="scheduled-tasks-section">
                <h3>â° Scheduled Tasks</h3>
                <div id="scheduled-tasks-content"><p>Loading...</p></div>
                <button id="scheduled-tasks-refresh" class="refresh-btn">â†» Refresh</button>
            </section>

            <section class="admin-panel user-mgmt-panel" id="user-mgmt-section">
                <h3>ğŸ‘¥ User Management</h3>
                <div id="user-mgmt-content"><p>Loading...</p></div>
                <button id="user-mgmt-refresh" class="refresh-btn">â†» Refresh</button>
            </section>

            <section class="admin-panel perf-metrics-panel" id="perf-metrics-ext-section">
                <h3>ğŸ“ˆ Performance Metrics</h3>
                <div id="perf-metrics-content"><p>Loading...</p></div>
                <div class="perf-actions">
                    <button id="perf-metrics-refresh" class="refresh-btn">â†» Refresh</button>
                    <button id="perf-metrics-reset" class="refresh-btn">ğŸ—‘ï¸ Reset</button>
                </div>
            </section>

            <section class="admin-panel env-config-panel" id="env-config-section">
                <h3>âš™ï¸ Environment Config</h3>
                <div id="env-config-content"><p>Loading...</p></div>
                <div class="env-config-actions">
                    <button id="env-config-refresh" class="refresh-btn">â†» Refresh</button>
                </div>
            </section>

            <section class="admin-panel session-analytics-panel" id="session-analytics-section">
                <h3>ğŸ“‰ Session Analytics</h3>
                <div id="session-analytics-content"><p>Loading...</p></div>
                <div class="session-analytics-actions">
                    <button id="session-analytics-refresh" class="refresh-btn">â†» Refresh</button>
                </div>
            </section>

            <section class="admin-panel content-moderation-panel" id="content-moderation-section">
                <h3>ğŸ›¡ï¸ Content Moderation</h3>
                <div id="content-moderation-content"><p>Loading...</p></div>
                <div class="content-moderation-actions">
                    <button id="content-moderation-refresh" class="refresh-btn">â†» Refresh</button>
                    <button id="content-moderation-clear" class="refresh-btn" style="background:#ef4444;">Clear Flags</button>
                </div>
            </section>

            <section class="admin-panel export-manager-panel" id="export-manager-section">
                <h3>ğŸ“¦ Export Manager</h3>
                <div id="export-manager-content"><p>Loading...</p></div>
                <div class="export-manager-actions">
                    <button id="export-manager-refresh" class="refresh-btn">â†» Refresh</button>
                    <button id="export-manager-clear" class="refresh-btn" style="background:#ef4444;">Clear History</button>
                </div>
            </section>

            <section class="admin-panel rate-limits-panel" id="rate-limits-section">
                <h3>ğŸš¦ Rate Limit Dashboard</h3>
                <div id="rate-limits-content"><p>Loading...</p></div>
                <div class="rate-limits-actions">
                    <button id="rate-limits-refresh" class="refresh-btn">â†» Refresh</button>
                </div>
            </section>

            <section class="admin-panel db-stats-panel" id="db-stats-section">
                <h3>ğŸ—„ï¸ Database Statistics</h3>
                <div id="db-stats-content"><p>Loading...</p></div>
                <div class="db-stats-actions">
                    <button id="db-stats-refresh" class="refresh-btn">â†» Refresh</button>
                </div>
            </section>

            <section class="admin-panel sys-notif-panel" id="sys-notif-section">
                <h3>ğŸ”” System Notifications</h3>
                <div id="sys-notif-content"><p>Loading...</p></div>
                <div class="sys-notif-actions">
                    <button id="sys-notif-refresh" class="refresh-btn">â†» Refresh</button>
                    <button id="sys-notif-add" class="refresh-btn" style="background:#6c63ff;">+ Add Notification</button>
                </div>
            </section>

            <!-- Audit Log Panel -->
            <section class="admin-panel audit-log-panel" id="audit-log-section">
                <h3>ğŸ“‹ Audit Log</h3>
                <div id="audit-log-content"><p>Loading...</p></div>
                <div class="audit-log-actions">
                    <button id="audit-log-refresh" class="refresh-btn">â†» Refresh</button>
                </div>
            </section>

            <!-- System Health Dashboard -->
            <section class="admin-panel sys-health-panel" id="sys-health-section">
                <h3>ğŸ’š System Health</h3>
                <div id="sys-health-content"><p>Loading...</p></div>
                <div class="sys-health-actions">
                    <button id="sys-health-refresh" class="refresh-btn">â†» Refresh</button>
                </div>
            </section>

            <!-- API Usage Analytics -->
            <section class="admin-panel api-analytics-panel" id="api-analytics-section">
                <h3>ğŸ“Š API Usage Analytics</h3>
                <div id="api-analytics-content"><p>Loading...</p></div>
                <div class="api-analytics-actions">
                    <button id="api-analytics-refresh" class="refresh-btn">â†» Refresh</button>
                </div>
            </section>

            <!-- User Activity Panel -->
            <section class="admin-panel user-activity-panel" id="user-activity-section">
                <h3>ğŸ‘¥ User Activity</h3>
                <div id="user-activity-content"><p>Loading...</p></div>
                <div class="user-activity-actions">
                    <button id="user-activity-refresh" class="refresh-btn">â†» Refresh</button>
                </div>
            </section>

            <section class="admin-panel feature-usage-panel" id="feature-usage-section">
                <h3>ğŸ“Š Feature Usage Stats</h3>
                <div id="feature-usage-content"><p>Loading...</p></div>
                <div class="feature-usage-actions">
                    <button id="feature-usage-refresh" class="refresh-btn">â†» Refresh</button>
                </div>
            </section>

            <section class="admin-panel error-tracker-panel" id="error-tracker-section">
                <h3>ğŸ› Error Tracker</h3>
                <div id="error-tracker-content"><p>Loading...</p></div>
                <div class="error-tracker-actions">
                    <button id="error-tracker-refresh" class="refresh-btn">â†» Refresh</button>
                </div>
            </section>

            <!-- Compact Quota Widget -->
            <section class="quota-compact" id="quota-dashboard">
                <button class="quota-toggle" id="quota-toggle" type="button">
                    <span class="quota-toggle-icon">â–¸</span> API Usage
                    <span class="quota-timer-badge" id="quota-reset-timer">--:--</span>
                </button>
                <div class="quota-content" id="quota-content" style="display: none;">
                    <table class="quota-table" id="quota-models">
                        <thead>
                            <tr><th>Model</th><th>RPM</th><th>TPM</th><th>RPD</th></tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="4" class="quota-loading">Loading...</td></tr>
                        </tbody>
                    </table>
                    <div class="quota-footer">
                        <span class="quota-updated" id="quota-updated">--</span>
                    </div>
                </div>
            </section>

            <!-- Search & Filter -->
            <section class="admin-controls">
                <div class="search-bar">
                    <input type="text" id="case-search" placeholder="Search by case ID, type, or location..." class="search-input">
                    <button id="search-btn" class="btn btn-primary">ğŸ”</button>
                </div>
                <div id="filters-panel" class="filters-panel">
                    <div class="quick-filter-chips" id="quick-filter-chips">
                        <button type="button" class="quick-filter-chip active" data-quick-filter="">All</button>
                        <button type="button" class="quick-filter-chip" data-quick-filter="open">Open</button>
                        <button type="button" class="quick-filter-chip" data-quick-filter="under_review">Review</button>
                        <button type="button" class="quick-filter-chip" data-quick-filter="closed">Closed</button>
                        <button type="button" class="quick-filter-chip" data-quick-filter="high_priority">Priority</button>
                        <button type="button" class="quick-filter-chip" data-quick-filter="has_scene">Has Scene</button>
                        <button type="button" class="quick-filter-chip" data-quick-filter="mine">Mine</button>
                        <button type="button" class="quick-filter-chip" data-quick-filter="unassigned">Unassigned</button>
                        <button type="button" id="filters-panel-toggle" class="quick-filter-chip" onclick="document.getElementById('filters-panel').classList.toggle('show-advanced'); this.textContent = document.getElementById('filters-panel').classList.contains('show-advanced') ? 'â–´ Less' : 'â–¾ More';" aria-expanded="false">â–¾ More</button>
                    </div>
                    <div class="filter-controls">
                        <select id="filter-type" class="filter-select">
                            <option value="">All Types</option>
                            <option value="accident">Accident</option>
                            <option value="crime">Crime</option>
                            <option value="incident">Incident</option>
                            <option value="other">Other</option>
                        </select>
                        <select id="filter-status" class="filter-select">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="complete">Complete</option>
                            <option value="review">Under Review</option>
                        </select>
                        <select id="sort-by" class="filter-select">
                            <option value="date-desc">Newest</option>
                            <option value="date-asc">Oldest</option>
                            <option value="reports-desc">Most Reports</option>
                            <option value="priority-desc">Priority</option>
                        </select>
                        <select id="auto-refresh-interval" class="filter-select" aria-label="Auto refresh">
                            <option value="0">Auto-refresh: Off</option>
                            <option value="30">30s</option>
                            <option value="60">60s</option>
                        </select>
                        <button id="clear-filters-btn" class="btn btn-secondary btn-sm">Clear</button>
                        <button id="auto-assign-orphans-btn" class="btn btn-secondary btn-sm">Auto-Assign</button>
                    </div>
                    <div class="filter-presets-row">
                        <select id="filter-preset-select" class="filter-select" aria-label="Saved filter presets">
                            <option value="">Presetsâ€¦</option>
                        </select>
                        <input type="text" id="filter-preset-name" class="assign-input" placeholder="Name" maxlength="60">
                        <button id="filter-preset-save" class="btn btn-secondary btn-sm">ğŸ’¾</button>
                        <button id="filter-preset-load" class="btn btn-secondary btn-sm">ğŸ“‚</button>
                        <button id="filter-preset-delete" class="btn btn-secondary btn-sm">ğŸ—‘</button>
                        <button id="filter-preset-export" class="btn btn-secondary btn-sm">â¬‡</button>
                        <label for="filter-preset-import" class="btn btn-secondary btn-sm">â¬†</label>
                        <input type="file" id="filter-preset-import" accept="application/json" style="display:none;">
                    </div>
                </div>
            </section>

            <div id="admin-error-banner" class="error-banner" style="display:none;">
                <span id="admin-error-text"></span>
                <button id="error-retry-btn" class="btn btn-secondary btn-sm">Retry</button>
            </div>

            <!-- Advanced Search Toolbar -->
            <div class="search-toolbar">
                <div class="search-input-wrapper">
                    <input type="text" id="search-query" placeholder="Search cases, reports, witnesses..." 
                           oninput="window.adminPortal?.debounceSearch()">
                    <span class="search-icon">ğŸ”</span>
                </div>
                <div class="filter-chips">
                    <select id="adv-filter-status" onchange="window.adminPortal?.applyAdvancedFilters()">
                        <option value="">All Status</option>
                        <option value="open">Open</option>
                        <option value="under_review">Under Review</option>
                        <option value="closed">Closed</option>
                    </select>
                    <select id="adv-filter-type" onchange="window.adminPortal?.applyAdvancedFilters()">
                        <option value="">All Types</option>
                        <option value="accident">Accident</option>
                        <option value="crime">Crime</option>
                        <option value="incident">Incident</option>
                        <option value="other">Other</option>
                    </select>
                    <input type="date" id="filter-date-from" onchange="window.adminPortal?.applyAdvancedFilters()" title="From date">
                    <input type="date" id="filter-date-to" onchange="window.adminPortal?.applyAdvancedFilters()" title="To date">
                    <select id="filter-source" onchange="window.adminPortal?.applyAdvancedFilters()">
                        <option value="">All Sources</option>
                        <option value="chat">ğŸ’¬ Chat</option>
                        <option value="phone">ğŸ“ Phone</option>
                        <option value="voice">ğŸ™ï¸ Voice</option>
                        <option value="email">ğŸ“§ Email</option>
                    </select>
                </div>
            </div>

            <!-- Bulk Operations Toolbar -->
            <div id="bulk-toolbar" class="bulk-toolbar" style="display:none;">
                <span id="selected-count">0 selected</span>
                <div class="bulk-inline-group">
                    <button onclick="window.adminPortal?.bulkUpdateStatus('under_review')" class="bulk-btn">Review</button>
                    <button onclick="window.adminPortal?.bulkUpdateStatus('closed')" class="bulk-btn">Close</button>
                    <button onclick="window.adminPortal?.bulkExport()" class="bulk-btn">Export</button>
                </div>
                <div class="bulk-inline-group bulk-control-group">
                    <select id="bulk-assign-investigator" class="filter-select" aria-label="Assign investigator">
                        <option value="">Assign toâ€¦</option>
                    </select>
                    <button onclick="window.adminPortal?.bulkAssignSelected()" class="bulk-btn">Assign</button>
                </div>
                <div class="bulk-inline-group bulk-control-group">
                    <select id="bulk-priority-label" class="filter-select" aria-label="Priority">
                        <option value="">Priorityâ€¦</option>
                        <option value="critical">Critical</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                    <input id="bulk-priority-score" class="assign-input" type="number" min="0" max="100" step="1" placeholder="Score">
                    <button onclick="window.adminPortal?.bulkSetPrioritySelected()" class="bulk-btn">Set</button>
                </div>
                <div class="bulk-inline-group">
                    <button onclick="window.adminPortal?.bulkTogglePinned(true)" class="bulk-btn">Pin</button>
                    <button onclick="window.adminPortal?.bulkToggleWatchlisted(true)" class="bulk-btn">Watch</button>
                    <input id="bulk-tag-text" class="assign-input" type="text" placeholder="Tag">
                    <input id="bulk-tag-color" type="color" value="#60a5fa" title="Tag color">
                    <button onclick="window.adminPortal?.bulkAddTagSelected()" class="bulk-btn">Tag</button>
                </div>
                <button onclick="window.adminPortal?.clearSelection()" class="bulk-btn danger">âœ– Clear</button>
            </div>

            <!-- View Toggle Tabs -->
            <section class="view-toggle" role="tablist" aria-label="Dashboard views">
                <button class="view-tab active" data-view="cases" role="tab" aria-selected="true">Cases</button>
                <button class="view-tab" data-view="pinned" role="tab" aria-selected="false">Pinned</button>
                <button class="view-tab" data-view="watchlist" role="tab" aria-selected="false">Watchlist</button>
                <button class="view-tab" data-view="reports" role="tab" aria-selected="false">Reports</button>
                <button class="view-tab" data-view="workload" role="tab" aria-selected="false">Workload</button>
                <button class="view-tab" data-view="dashboard" role="tab" aria-selected="false">Analytics</button>
                <button class="view-tab" data-view="map" role="tab" aria-selected="false">Map</button>
                <button class="view-tab" data-view="settings" role="tab" aria-selected="false">Settings</button>
            </section>

            <aside id="admin-side-panel" class="admin-side-panel">
                <h3>Quick Shortcuts</h3>
                <div class="side-panel-counts">
                    <button class="side-shortcut-btn" onclick="window.adminPortal?.switchView('pinned')">ğŸ“Œ Pinned <span id="side-pinned-count">0</span></button>
                    <button class="side-shortcut-btn" onclick="window.adminPortal?.switchView('watchlist')">ğŸ‘ Watchlist <span id="side-watch-count">0</span></button>
                </div>
                <div class="side-panel-shortcuts">
                    <button class="side-shortcut-btn" onclick="window.adminPortal?.openCommandPalette()">âŒ˜/Ctrl+K Commands</button>
                    <button class="side-shortcut-btn" onclick="window.adminPortal?.openShortcutsHelp()">â” Keyboard Help</button>
                    <button class="side-shortcut-btn" onclick="window.adminPortal?.switchView('cases')">ğŸ“ Back to Cases</button>
                </div>
            </aside>

            <section class="cases-section recent-actions-section" id="recent-actions-section">
                <div class="section-header">
                    <h2>Recent Actions</h2>
                </div>
                <div id="recent-actions-list" class="recent-actions-list">
                    <div class="empty-state">No recent actions yet</div>
                </div>
            </section>

            <section class="cases-section recent-viewed-section" id="recent-viewed-section">
                <div class="section-header">
                    <h2>Recently Viewed Cases</h2>
                </div>
                <div id="recent-viewed-list" class="recent-viewed-list">
                    <div class="empty-state">No recently viewed cases</div>
                </div>
            </section>

            <!-- Cases List -->
            <section class="cases-section" id="cases-section" role="tabpanel" aria-label="Cases view">
                <div class="section-header">
                    <h2>Cases <span class="section-subtitle" id="cases-count-subtitle"></span></h2>
                    <div class="cases-view-mode">
                        <button class="view-mode-btn active" data-mode="compact" title="Compact View" aria-label="Compact view">â–¦</button>
                        <button class="view-mode-btn" data-mode="expanded" title="Expanded View" aria-label="Expanded view">â–£</button>
                    </div>
                </div>
                
                <div id="cases-list" class="cases-list cases-compact">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p>Loading cases...</p>
                    </div>
                </div>
            </section>

            <!-- Reports List (hidden by default) -->
            <section class="cases-section" id="reports-section" style="display: none;">
                <div class="section-header">
                    <h2>Individual Reports <span class="section-subtitle" id="reports-count-subtitle"></span></h2>
                </div>
                
                <div id="reports-list" class="cases-list">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p>Loading reports...</p>
                    </div>
                </div>
            </section>

            <!-- Workload View -->
            <section id="workload-section" class="workload-section" style="display: none;">
                <div class="section-header">
                    <h2>ğŸ‘® Investigator Workload</h2>
                    <button id="add-investigator-btn" class="btn btn-primary btn-sm">â• Add Investigator</button>
                </div>

                <!-- Workload Summary Stats -->
                <div class="workload-stats" id="workload-stats">
                    <div class="workload-stat-card">
                        <div class="workload-stat-value" id="stat-total-investigators">0</div>
                        <div class="workload-stat-label">Investigators</div>
                    </div>
                    <div class="workload-stat-card">
                        <div class="workload-stat-value" id="stat-active-cases">0</div>
                        <div class="workload-stat-label">Assigned Cases</div>
                    </div>
                    <div class="workload-stat-card">
                        <div class="workload-stat-value" id="stat-unassigned-cases">0</div>
                        <div class="workload-stat-label">Unassigned</div>
                    </div>
                    <div class="workload-stat-card">
                        <div class="workload-stat-value" id="stat-avg-utilization">0%</div>
                        <div class="workload-stat-label">Avg Utilization</div>
                    </div>
                </div>

                <!-- Investigators Grid -->
                <div id="investigators-grid" class="investigators-grid">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p>Loading workload data...</p>
                    </div>
                </div>
            </section>

            <!-- Add/Edit Investigator Modal -->
            <div id="investigator-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="investigator-modal-title">Add Investigator</h2>
                        <button class="modal-close" onclick="window.adminPortal?.closeInvestigatorModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="investigator-form">
                            <input type="hidden" id="inv-edit-id">
                            <div class="form-group">
                                <label for="inv-name">Name *</label>
                                <input type="text" id="inv-name" class="form-input" placeholder="Officer name" required>
                            </div>
                            <div class="form-group">
                                <label for="inv-badge">Badge Number</label>
                                <input type="text" id="inv-badge" class="form-input" placeholder="Badge #">
                            </div>
                            <div class="form-group">
                                <label for="inv-email">Email</label>
                                <input type="email" id="inv-email" class="form-input" placeholder="email@department.gov">
                            </div>
                            <div class="form-group">
                                <label for="inv-department">Department</label>
                                <input type="text" id="inv-department" class="form-input" placeholder="e.g., Homicide, Traffic">
                            </div>
                            <div class="form-group">
                                <label for="inv-max-cases">Max Cases</label>
                                <input type="number" id="inv-max-cases" class="form-input" value="10" min="1" max="50">
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="window.adminPortal?.closeInvestigatorModal()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Dashboard View -->
            <div id="dashboard-view" class="dashboard-container" style="display:none;" role="tabpanel" aria-label="Dashboard view">
                <!-- Dashboard Summary Cards -->
                <div class="dashboard-summary-row">
                    <div class="dashboard-summary-card">
                        <div class="summary-icon">ğŸ“</div>
                        <div class="summary-content">
                            <div class="summary-value" id="dash-total-cases">0</div>
                            <div class="summary-label">Total Cases</div>
                        </div>
                    </div>
                    <div class="dashboard-summary-card">
                        <div class="summary-icon">ğŸ“†</div>
                        <div class="summary-content">
                            <div class="summary-value" id="dash-cases-today">0</div>
                            <div class="summary-label">Cases Today</div>
                        </div>
                    </div>
                    <div class="dashboard-summary-card">
                        <div class="summary-icon">ğŸ“…</div>
                        <div class="summary-content">
                            <div class="summary-value" id="dash-cases-week">0</div>
                            <div class="summary-label">This Week</div>
                        </div>
                    </div>
                    <div class="dashboard-summary-card">
                        <div class="summary-icon">â±ï¸</div>
                        <div class="summary-content">
                            <div class="summary-value" id="dash-avg-response">-</div>
                            <div class="summary-label">Avg Response (hrs)</div>
                        </div>
                    </div>
                </div>
                
                <!-- Chart Grid -->
                <div class="dashboard-grid">
                    <div class="chart-card chart-card-wide">
                        <h3>ğŸ“ˆ Crime Trends Over Time</h3>
                        <div class="chart-controls">
                            <button class="chart-period-btn active" data-period="daily">Daily</button>
                            <button class="chart-period-btn" data-period="weekly">Weekly</button>
                            <button class="chart-period-btn" data-period="monthly">Monthly</button>
                        </div>
                        <canvas id="cases-timeline-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>ğŸ·ï¸ Cases by Type</h3>
                        <canvas id="incident-types-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>ğŸ“‹ Case Status Distribution</h3>
                        <canvas id="case-status-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>â±ï¸ Response Time by Type</h3>
                        <canvas id="response-time-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>ğŸ“Š Report Sources</h3>
                        <canvas id="source-distribution-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>ğŸ• Incidents by Hour</h3>
                        <canvas id="hour-distribution-chart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>ğŸ“… Incidents by Day of Week</h3>
                        <canvas id="day-distribution-chart"></canvas>
                    </div>
                </div>
                
                <!-- Geographic Distribution Section -->
                <div class="geo-distribution-section">
                    <h3>ğŸ—ºï¸ Geographic Distribution</h3>
                    <div class="geo-content">
                        <div class="geo-map-container">
                            <div id="dashboard-map" style="height: 350px; width: 100%; border-radius: 8px;"></div>
                        </div>
                        <div class="geo-top-locations">
                            <h4>Top Locations</h4>
                            <div id="top-locations-list" class="top-locations-list">
                                <p class="empty-state">Loading locations...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Map View -->
            <div id="map-view" class="map-container" style="display:none;" role="tabpanel" aria-label="Map view">
                <div id="incident-map" style="height: 500px; width: 100%; border-radius: 12px;"></div>
                <div id="map-no-data" class="empty-state" style="display:none;">No location data available for cases</div>
            </div>

            <!-- Settings / API Section -->
            <div id="settings-view" class="settings-container" style="display:none;" role="tabpanel" aria-label="Settings view">
                <!-- API Keys Management -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <h3>ğŸ”‘ API Keys</h3>
                        <button class="btn btn-primary btn-sm" id="create-api-key-btn">+ Create Key</button>
                    </div>
                    <p class="settings-desc">Generate API keys to access WitnessReplay programmatically. Keys provide full access to create sessions, send messages, retrieve scenes, and manage cases â€” everything the web UI can do.</p>
                    <div id="api-keys-list" class="api-keys-list">
                        <div class="empty-state">Loading API keys...</div>
                    </div>
                </div>

                <!-- Create API Key Modal (inline) -->
                <div id="create-key-form" class="settings-card" style="display:none;">
                    <h3>Create New API Key</h3>
                    <div class="form-group">
                        <label>Key Name</label>
                        <input type="text" id="new-key-name" placeholder="e.g. Mobile App, CI Pipeline, Partner Integration" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Permissions</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" value="read" checked disabled> Read (sessions, cases, scenes)</label>
                            <label><input type="checkbox" value="write" checked> Write (create sessions, send messages)</label>
                            <label><input type="checkbox" value="admin"> Admin (manage cases, export)</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Rate Limit (requests/min)</label>
                        <input type="number" id="new-key-rate-limit" value="30" min="1" max="120" class="form-input" style="width:120px;">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" id="confirm-create-key">Create Key</button>
                        <button class="btn btn-secondary" id="cancel-create-key">Cancel</button>
                    </div>
                </div>

                <!-- Rate Limit Monitor -->
                <div class="settings-section">
                    <h3>ğŸ“Š Rate Limit Monitor</h3>
                    <div id="rate-limit-stats" class="rate-limit-stats"><p style="color:var(--text-secondary)">Loading...</p></div>
                    <button onclick="window.adminPortal?.loadRateLimits()" class="btn-secondary" style="margin-top:8px;">ğŸ”„ Refresh</button>
                </div>

                <!-- New Key Display (shown once after creation) -->
                <div id="new-key-display" class="settings-card key-created-card" style="display:none;">
                    <h3>ğŸ‰ API Key Created</h3>
                    <p class="key-warning">âš ï¸ Copy this key now â€” it will never be shown again!</p>
                    <div class="key-display">
                        <code id="new-key-value"></code>
                        <button class="btn btn-sm" id="copy-key-btn" onclick="navigator.clipboard.writeText(document.getElementById('new-key-value').textContent).then(()=>{this.textContent='âœ… Copied!'})">ğŸ“‹ Copy</button>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="document.getElementById('new-key-display').style.display='none'">Done</button>
                </div>

                <!-- API Documentation -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <h3>ğŸ“– API Documentation</h3>
                        <a href="/docs" target="_blank" class="btn btn-secondary btn-sm">Open Swagger UI â†’</a>
                    </div>
                    <p class="settings-desc">All endpoints below require the <code>X-API-Key</code> header. Base URL: <code id="api-base-url"></code></p>

                    <div class="api-docs">
                        <!-- Quick Start -->
                        <div class="api-section">
                            <h4>ğŸš€ Quick Start</h4>
                            <div class="code-block">
                                <div class="code-tabs">
                                    <button class="code-tab active" data-lang="curl">cURL</button>
                                    <button class="code-tab" data-lang="python">Python</button>
                                    <button class="code-tab" data-lang="javascript">JavaScript</button>
                                </div>
                                <pre class="code-content" data-lang="curl"><code># 1. Create a session
curl -X POST <span class="api-url"></span>/api/v1/sessions \
  -H "X-API-Key: wr_your_key_here" \
  -H "Content-Type: application/json" \
  -d '{"template": "general"}'

# 2. Send a witness statement
curl -X POST <span class="api-url"></span>/api/v1/sessions/{session_id}/message \
  -H "X-API-Key: wr_your_key_here" \
  -H "Content-Type: application/json" \
  -d '{"text": "I saw a red car run a stop sign and hit a pedestrian"}'

# 3. Get the scene reconstruction
curl <span class="api-url"></span>/api/v1/sessions/{session_id}/scene \
  -H "X-API-Key: wr_your_key_here"</code></pre>
                                <pre class="code-content" data-lang="python" style="display:none;"><code>import requests

BASE = "<span class="api-url"></span>/api/v1"
HEADERS = {"X-API-Key": "wr_your_key_here"}

# 1. Create a session
session = requests.post(f"{BASE}/sessions",
    headers=HEADERS, json={"template": "general"}).json()
sid = session["session"]["id"]

# 2. Send a witness statement
response = requests.post(f"{BASE}/sessions/{sid}/message",
    headers=HEADERS,
    json={"text": "I saw a red car run a stop sign"}).json()
print(response["ai_response"])

# 3. Get the scene
scene = requests.get(f"{BASE}/sessions/{sid}/scene",
    headers=HEADERS).json()
print(scene["latest_version"])</code></pre>
                                <pre class="code-content" data-lang="javascript" style="display:none;"><code>const BASE = '<span class="api-url"></span>/api/v1';
const headers = {
  'X-API-Key': 'wr_your_key_here',
  'Content-Type': 'application/json'
};

// 1. Create a session
const session = await fetch(`${BASE}/sessions`, {
  method: 'POST', headers, body: JSON.stringify({template: 'general'})
}).then(r => r.json());
const sid = session.session.id;

// 2. Send a witness statement
const response = await fetch(`${BASE}/sessions/${sid}/message`, {
  method: 'POST', headers,
  body: JSON.stringify({text: 'I saw a red car run a stop sign'})
}).then(r => r.json());
console.log(response.ai_response);

// 3. Get scene reconstruction
const scene = await fetch(`${BASE}/sessions/${sid}/scene`, {
  headers
}).then(r => r.json());</code></pre>
                            </div>
                        </div>

                        <!-- Endpoints Reference -->
                        <div class="api-section">
                            <h4>ğŸ“‹ Endpoints Reference</h4>
                            <table class="api-table">
                                <thead>
                                    <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td><span class="method post">POST</span></td><td>/api/v1/sessions</td><td>Create a new interview session</td></tr>
                                    <tr><td><span class="method get">GET</span></td><td>/api/v1/sessions/{id}</td><td>Get session details + statements</td></tr>
                                    <tr><td><span class="method post">POST</span></td><td>/api/v1/sessions/{id}/message</td><td>Send text â†’ get AI response + scene</td></tr>
                                    <tr><td><span class="method post">POST</span></td><td>/api/v1/sessions/{id}/audio</td><td>Send audio (base64) â†’ transcribe + respond</td></tr>
                                    <tr><td><span class="method get">GET</span></td><td>/api/v1/sessions/{id}/scene</td><td>Get scene reconstruction image</td></tr>
                                    <tr><td><span class="method get">GET</span></td><td>/api/v1/sessions/{id}/transcript</td><td>Get full interview transcript</td></tr>
                                    <tr><td><span class="method get">GET</span></td><td>/api/v1/cases</td><td>List all cases</td></tr>
                                    <tr><td><span class="method get">GET</span></td><td>/api/v1/cases/{id}</td><td>Get case with linked reports</td></tr>
                                    <tr><td><span class="method post">POST</span></td><td>/api/v1/cases/{id}/export</td><td>Export case (JSON/RMS)</td></tr>
                                    <tr><td><span class="method get">GET</span></td><td>/api/v1/status</td><td>API health + quota status</td></tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Authentication -->
                        <div class="api-section">
                            <h4>ğŸ” Authentication</h4>
                            <p>Include your API key in every request:</p>
                            <pre><code>X-API-Key: wr_xxxxxxxxxxxxxxxxxxxxxxxxxxxx</code></pre>
                            <p>Keys are created in the API Keys section above. Each key has its own rate limit and permissions. Keys can be revoked at any time.</p>
                        </div>

                        <!-- Rate Limits -->
                        <div class="api-section">
                            <h4>â±ï¸ Rate Limits</h4>
                            <p>Default: <strong>30 requests/minute</strong> per API key. Configurable per key. When exceeded, the API returns <code>429 Too Many Requests</code> with a <code>Retry-After</code> header.</p>
                            <p>AI-powered endpoints (/message, /audio) also count against Google Gemini API quotas (5 RPM for Flash, 10 RPM for Flash Lite).</p>
                        </div>

                        <!-- Response Format -->
                        <div class="api-section">
                            <h4>ğŸ“¦ Response Format</h4>
                            <p>All responses are JSON. Successful responses return the data directly. Errors return:</p>
                            <pre><code>{"detail": "Error description", "status_code": 404}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Case Detail Modal -->
    <div id="case-detail-modal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h2 id="case-detail-title">Case Details</h2>
                <button class="modal-close" data-modal="case-detail-modal">&times;</button>
            </div>
            
            <div class="modal-body" id="modal-body-content">
                <div class="case-detail-container">
                    <!-- Privacy Notice -->
                    <div class="privacy-notice">
                        <span>ğŸ”’</span>
                        <span>Witness identities are protected. Report numbers are used instead of names.</span>
                    </div>

                    <!-- Priority Section -->
                    <section class="case-priority-section" id="detail-priority-section">
                        <h3>ğŸ“Š Priority Assessment</h3>
                        <div class="priority-overview">
                            <div class="priority-score-display">
                                <span class="priority-score-value" id="detail-priority-score">-</span>
                                <span class="priority-score-label">/100</span>
                            </div>
                            <span class="priority-label-badge" id="detail-priority-label">-</span>
                        </div>
                        <div class="priority-breakdown" id="detail-priority-breakdown">
                            <div class="priority-factor">
                                <div class="priority-factor-value" id="priority-severity">-</div>
                                <div class="priority-factor-label">Severity</div>
                            </div>
                            <div class="priority-factor">
                                <div class="priority-factor-value" id="priority-age">-</div>
                                <div class="priority-factor-label">Age</div>
                            </div>
                            <div class="priority-factor">
                                <div class="priority-factor-value" id="priority-solvability">-</div>
                                <div class="priority-factor-label">Solvability</div>
                            </div>
                            <div class="priority-factor">
                                <div class="priority-factor-value" id="priority-witnesses">-</div>
                                <div class="priority-factor-label">Witnesses</div>
                            </div>
                        </div>
                        <div class="priority-factors-list" id="detail-priority-factors"></div>
                    </section>

                    <!-- Case Info -->
                    <section class="case-info">
                        <h3>Case Information</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Case Number:</label>
                                <span id="detail-case-number">-</span>
                            </div>
                            <div class="info-item">
                                <label>Title:</label>
                                <span id="detail-case-title">-</span>
                            </div>
                            <div class="info-item">
                                <label>Location:</label>
                                <span id="detail-case-location">-</span>
                            </div>
                            <div class="info-item">
                                <label>Status:</label>
                                <span id="detail-case-status">-</span>
                            </div>
                            <div class="info-item">
                                <label>Created:</label>
                                <span id="detail-created">-</span>
                            </div>
                            <div class="info-item">
                                <label>Last Updated:</label>
                                <span id="detail-updated">-</span>
                            </div>
                        </div>
                    </section>

                    <!-- Timeframe -->
                    <section class="case-timeframe" id="detail-timeframe-section" style="display: none;">
                        <h3>Timeframe</h3>
                        <div class="timeframe-display">
                            <div class="timeframe-range">
                                <span class="timeframe-start" id="detail-timeframe-start"></span>
                                <span class="timeframe-arrow">â†’</span>
                                <span class="timeframe-end" id="detail-timeframe-end"></span>
                            </div>
                            <div class="timeframe-description" id="detail-timeframe-desc"></div>
                        </div>
                    </section>

                    <!-- Case Summary -->
                    <section class="case-summary-section" id="detail-summary-section" style="display: none;">
                        <h3>AI-Generated Summary</h3>
                        <div class="case-summary-text" id="detail-case-summary"></div>
                    </section>

                    <!-- Scene Image -->
                    <section class="scene-image-section" id="detail-scene-image-section" style="display: none;">
                        <h3>Scene Reconstruction</h3>
                        <div class="scene-image-container">
                            <img id="detail-scene-image" src="" alt="Scene reconstruction" loading="lazy">
                        </div>
                    </section>

                    <!-- Witness Scene Comparison -->
                    <section class="case-comparison-section" id="detail-comparison-section" style="display:none;">
                        <h3>ğŸ” Witness Scene Comparison</h3>
                        <div id="comparison-grid" class="comparison-grid"></div>
                    </section>

                    <!-- Reports within Case -->
                    <section class="case-reports-section">
                        <h3>Reports (<span id="detail-report-count">0</span>)</h3>
                        <div id="detail-reports-list" class="case-reports-list">
                            <p class="empty-state">No reports in this case</p>
                        </div>
                    </section>

                    <!-- Key Elements -->
                    <section class="case-key-elements" id="detail-key-elements-section" style="display: none;">
                        <h3>Key Elements</h3>
                        <div id="detail-key-elements" class="key-elements-tags"></div>
                    </section>

                    <!-- Case Timeline -->
                    <section class="case-timeline">
                        <h3>ğŸ“… Case Timeline</h3>
                        <div class="timeline-view-toggle">
                            <button id="simple-timeline-btn" class="btn btn-secondary active" data-view="simple">Simple</button>
                            <button id="interactive-timeline-btn" class="btn btn-secondary" data-view="interactive">Interactive</button>
                        </div>
                        <div id="case-timeline" class="timeline-container"></div>
                        <div id="interactive-timeline-container" class="interactive-timeline" style="display:none; min-height: 350px; position: relative;"></div>
                    </section>

                    <!-- Interactive Case Timeline -->
                    <section class="case-timeline-section" id="detail-timeline-section" style="display:none;">
                        <h3>ğŸ“… Case Timeline</h3>
                        <div id="case-timeline-container" class="case-timeline-container"></div>
                    </section>

                    <!-- Case Tags -->
                    <section class="case-tags-section" id="case-tags-section">
                        <h3>ğŸ·ï¸ Tags</h3>
                        <div id="case-tags-list" class="case-tags-list"></div>
                        <div class="tag-add-form">
                            <input type="text" id="new-tag-input" class="form-input" placeholder="New tag...">
                            <input type="color" id="new-tag-color" value="#60a5fa" title="Tag color">
                            <button class="btn btn-primary btn-sm" onclick="window.adminPortal?.addCaseTag()">Add Tag</button>
                        </div>
                    </section>

                    <!-- Case Notes -->
                    <section class="case-notes-section" id="case-notes-section">
                        <h3>ğŸ“ Investigator Notes</h3>
                        <div class="note-add-form">
                            <textarea id="new-note-content" class="form-input" rows="3" placeholder="Add a note..."></textarea>
                            <button class="btn btn-primary btn-sm" onclick="window.adminPortal?.addCaseNote()">Add Note</button>
                        </div>
                        <div id="case-notes-list" class="case-notes-list"></div>
                    </section>

                    <!-- Case Deadlines -->
                    <section class="case-deadlines-section" id="case-deadlines-section">
                        <h3>â° Deadlines / SLA</h3>
                        <div id="case-deadlines-list" class="case-deadlines-list"></div>
                        <div class="deadline-add-form">
                            <select id="new-deadline-type" class="filter-select">
                                <option value="general">General</option>
                                <option value="sla">SLA</option>
                                <option value="court">Court Date</option>
                                <option value="review">Review</option>
                            </select>
                            <input type="datetime-local" id="new-deadline-date" class="form-input">
                            <input type="text" id="new-deadline-desc" class="form-input" placeholder="Description">
                            <button class="btn btn-primary btn-sm" onclick="window.adminPortal?.addCaseDeadline()">Add Deadline</button>
                        </div>
                    </section>

                    <!-- Audit Trail -->
                    <section class="audit-trail">
                        <h3>ğŸ“‹ Audit Trail</h3>
                        <div id="audit-trail-list" class="audit-list"></div>
                    </section>

                    <!-- Related Cases -->
                    <section class="related-cases-section" id="related-cases-section">
                        <div class="section-header">
                            <h3>ğŸ”— Related Cases</h3>
                            <button id="find-similar-btn" class="btn btn-secondary btn-sm">ğŸ” Find Similar Cases</button>
                        </div>
                        <div id="related-cases-list" class="related-cases-list">
                            <p class="empty-state">No related cases linked</p>
                        </div>
                        
                        <!-- Similar Cases Suggestions (hidden by default) -->
                        <div id="similar-cases-panel" class="similar-cases-panel" style="display: none;">
                            <h4>ğŸ“Š Suggested Similar Cases</h4>
                            <div id="similar-cases-list" class="similar-cases-list"></div>
                        </div>
                        
                        <!-- Manual Link Form -->
                        <div class="link-case-form" id="link-case-form" style="display: none;">
                            <h4>Link Another Case</h4>
                            <select id="link-case-select" class="filter-select">
                                <option value="">Select a case...</option>
                            </select>
                            <select id="link-type-select" class="filter-select">
                                <option value="related">Related</option>
                                <option value="same_incident">Same Incident</option>
                                <option value="serial">Serial Pattern</option>
                            </select>
                            <input type="text" id="link-notes-input" class="assign-input" placeholder="Notes (optional)">
                            <button id="confirm-link-btn" class="btn btn-primary btn-sm">Link Cases</button>
                            <button id="cancel-link-btn" class="btn btn-secondary btn-sm">Cancel</button>
                        </div>
                        <button id="add-link-btn" class="btn btn-secondary btn-sm">â• Link Case Manually</button>
                    </section>

                    <!-- Pattern Detection -->
                    <section class="pattern-detection-section" id="pattern-detection-section">
                        <div class="section-header">
                            <h3>ğŸ” Pattern Analysis</h3>
                            <button id="analyze-patterns-btn" class="btn btn-secondary btn-sm">ğŸ“Š Analyze Patterns</button>
                        </div>
                        <div id="patterns-container" class="patterns-container" style="display: none;">
                            <div class="pattern-category" id="time-patterns">
                                <h4>â° Time Patterns</h4>
                                <div class="pattern-list" id="time-patterns-list"></div>
                            </div>
                            <div class="pattern-category" id="location-patterns">
                                <h4>ğŸ“ Location Patterns</h4>
                                <div class="pattern-list" id="location-patterns-list"></div>
                            </div>
                            <div class="pattern-category" id="mo-patterns">
                                <h4>ğŸ¯ MO Patterns</h4>
                                <div class="pattern-list" id="mo-patterns-list"></div>
                            </div>
                            <div class="pattern-category" id="semantic-patterns">
                                <h4>ğŸ§  Semantic Matches</h4>
                                <div class="pattern-list" id="semantic-patterns-list"></div>
                            </div>
                        </div>
                        <p id="patterns-empty" class="empty-state">Click "Analyze Patterns" to detect patterns related to this case</p>
                    </section>

                    <!-- Status Workflow -->
                    <div class="status-workflow">
                        <label>Case Status:</label>
                        <select id="case-status-select" class="filter-select">
                            <option value="open">ğŸŸ¢ Open</option>
                            <option value="under_review">ğŸŸ¡ Under Review</option>
                            <option value="closed">ğŸ”´ Closed</option>
                        </select>
                        <button id="update-status-btn" class="btn btn-primary">Update Status</button>
                    </div>

                    <!-- Case Assignment -->
                    <section class="case-assignment-section">
                        <h3>ğŸ‘® Case Assignment</h3>
                        <div class="assignment-controls">
                            <div class="form-group">
                                <label for="investigator-select">Assign to Investigator:</label>
                                <select id="investigator-select" class="filter-select">
                                    <option value="">-- Select Investigator --</option>
                                </select>
                                <button id="assign-btn" class="btn btn-primary btn-sm" onclick="window.adminPortal?.assignCaseToInvestigator()">Assign</button>
                                <button id="unassign-btn" class="btn btn-secondary btn-sm" onclick="window.adminPortal?.unassignCase()" style="display:none;">Unassign</button>
                            </div>
                            <div class="current-assignment" id="current-assignment" style="display:none;">
                                <span class="assignment-badge">ğŸ‘® Assigned to: <strong id="current-assignee-name"></strong></span>
                            </div>
                        </div>
                        <!-- Assignment History -->
                        <div class="assignment-history" id="assignment-history-section" style="display:none;">
                            <h4>ğŸ“‹ Assignment History</h4>
                            <div id="assignment-history-list" class="assignment-history-list"></div>
                        </div>
                    </section>

                    <!-- Case Merge -->
                    <section class="case-merge-section" id="case-merge-section">
                        <h3>ğŸ”€ Merge Case</h3>
                        <div class="merge-form">
                            <input type="text" id="merge-source-id" class="form-input" placeholder="Source Case ID to merge into this case">
                            <button class="btn btn-warning btn-sm" onclick="window.adminPortal?.mergeCases()">Merge Into This Case</button>
                        </div>
                    </section>

                    <!-- Actions -->
                    <section class="case-actions">
                        <button id="regenerate-summary-btn" class="btn btn-primary">ğŸ¤– Regenerate Summary</button>
                        <button id="compare-reports-btn" class="btn btn-secondary">ğŸ“Š Compare Reports</button>
                        <button id="upload-evidence-btn" class="btn btn-secondary">ğŸ“· Upload Evidence Photo</button>
                        <button id="print-report-btn" class="btn btn-secondary">ğŸ–¨ï¸ Print Report</button>
                        <button id="export-case-btn" class="btn btn-secondary">ğŸ“¥ Export Case</button>
                        <button id="delete-case-btn" class="btn btn-danger">ğŸ—‘ï¸ Delete Case</button>
                    </section>
                </div>
            </div>
        </div>
    </div>




    <div id="command-palette" class="command-palette" style="display:none;" aria-hidden="true">
        <div class="command-palette-dialog" role="dialog" aria-modal="true" aria-label="Admin command palette">
            <input id="command-palette-input" type="text" class="command-palette-input" placeholder="Type a commandâ€¦">
            <div id="command-palette-list" class="command-palette-list"></div>
        </div>
    </div>

    <div id="shortcuts-help-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âŒ¨ï¸ Admin Shortcuts</h2>
                <button class="modal-close" data-modal="shortcuts-help-modal">&times;</button>
            </div>
            <div class="modal-body">
                <ul class="shortcuts-list">
                    <li><kbd>/</kbd> Focus search</li>
                    <li><kbd>R</kbd> Refresh cases</li>
                    <li><kbd>Ctrl/Cmd + K</kbd> Open command palette</li>
                    <li><kbd>A</kbd> Auto-assign orphan reports</li>
                    <li><kbd>P</kbd> Toggle pin on open case modal</li>
                    <li><kbd>W</kbd> Toggle watch on open case modal</li>
                    <li><kbd>?</kbd> Open this help</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Toast Notifications Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Version Display -->
    <div class="version-badge" id="version-display">
        <span class="version-label">v</span>
        <span class="version-number">0.051</span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/static/js/timeline.js"></script>
    <script src="/static/js/scene-animation.js"></script>
    <script src="/static/js/admin.js"></script>
</body>
</html>
